<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Data Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <h2 class="mb-4">Data Dashboard</h2>

      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
          <button
            class="nav-link active"
            data-bs-toggle="tab"
            data-bs-target="#userTab"
          >
            Users
          </button>
        </li>
        <li class="nav-item">
          <button
            class="nav-link"
            data-bs-toggle="tab"
            data-bs-target="#productTab"
          >
            Products
          </button>
        </li>
        <li class="nav-item">
          <button
            class="nav-link"
            data-bs-toggle="tab"
            data-bs-target="#cartTab"
          >
            Carts
          </button>
        </li>
      </ul>

      <div class="tab-content bg-white p-3 border border-top-0">
        <div class="tab-pane fade show active" id="userTab">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
              </tr>
            </thead>
            <tbody>
              {% for u in users %}
              <tr>
                <td>{{ u.external_id }}</td>
                <td><img src="{{ u.image_url }}" width="50" /></td>
                <td>{{ u.username }}</td>
                <td>{{ u.email }}</td>
                <td>{{ u.role }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="tab-pane fade" id="productTab">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Thumbnail</th>
                <th>Title</th>
                <th>Description</th>
                <th>Price</th>
                <th>Stock</th>
              </tr>
            </thead>
            <tbody>
              {% for p in products %}
              <tr>
                <td><img src="{{ p.thumbnail }}" width="50" /></td>
                <td>{{ p.title }}</td>
                <td>
                  <button
                    class="btn btn-sm btn-outline-primary"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#desc-{{p.id}}"
                  >
                    Open/Close
                  </button>
                  <div class="collapse mt-2" id="desc-{{p.id}}">
                    <div
                      class="card card-body shadow-sm"
                      style="min-width: 200px"
                    >
                      {{ p.description }}
                    </div>
                  </div>
                </td>
                <td>${{ p.price }}</td>
                <td>{{ p.stock }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="tab-pane fade" id="cartTab">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Cart ID</th>
                <th>User ID</th>
                <th>Total Quantity</th>
                <th>Final Price</th>
              </tr>
            </thead>
            <tbody>
              {% for c in carts %}
              <tr>
                <td>{{ c.external_id }}</td>
                <td>{{ c.user.username }} (ID: {{forloop.counter}})</td>
                <td>{{ c.total_quantity }}</td>
                <td><strong>${{ c.discounted_total }}</strong></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
